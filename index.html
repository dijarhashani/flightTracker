<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />


	<title>Live Flights Map - Flight Tracker</title>

	<link rel="shortcut icon" href="/img/favicon.svg" type="image/x-icon">
	
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="" crossorigin="" />
	
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	
	<link href="https://cdnjs.cloudflare.com/ajax/libs/startbootstrap-sb-admin-2/4.1.4/css/sb-admin-2.min.css" rel="stylesheet">
	
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/styles.css">
	<style>
		html,body,#map { height: 100%; margin:0; padding:0; }
		#map { height: 100vh; }
		.plane-popup { font-family: Arial, Helvetica, sans-serif; font-size: 13px; }
		body {
			background-color: #f8f9fc;
		}
		.topbar {
			background-color: white;
			box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
			padding: 1rem 1.5rem;
			z-index: 100;
		}
		.map-container {
			height: calc(100vh - 60px);
		}
		.navbar-brand {
			color: #4e73df !important;
			font-weight: 700;
		}
		.btn-logout {
			background-color: #e74c3c;
			color: white;
			border: none;
		}
		.btn-logout:hover {
			background-color: #c0392b;
			color: white;
		}
	</style>
	
</head>
<body>
	
	<div class="topbar d-flex justify-content-between align-items-center vh-20">
		<div class="d-flex align-items-center">
			<button class="btn btn-primary d-lg-none me-2" data-bs-toggle="offcanvas" data-bs-target="#sidebar">
				<i class="fas fa-bars"></i>
			</button>

			<h3 class="navbar-brand m-0">
				<i class="fas fa-plane text-primary"></i> Flight Tracker
			</h3>
		</div>

		<div class="d-flex align-items-center gap-3">
			<span id="userInfo" class="text-muted"></span>
			
		</div>
	</div>

	
<div class="d-flex flex-row dashboard-wrapper">

	
	<div id="sidebarWrapper" class="sidebar-desktop d-none d-lg-block">
		<div class="sidebar-inner w-100">
			<div class="list-group list-group-flush bg-white">

				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="mapScreen"  onclick="navigateTo('mapScreen')">
					<i class="fas fa-map"></i> Live Map
				</button>
				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="searchScreen" onclick="navigateTo('searchScreen')">
					<i class="fas fa-plane"></i> Airport Search
				</button>

				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="favoriteScreen" onclick="navigateTo('favoriteScreen')" data-bs-dismiss="offcanvas">
					<i class="fas fa-star"></i> Favorites
				</button>

				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="bookScreen" onclick="navigateTo('bookScreen')">
					<i class="fas fa-ticket-alt"></i> Book Flight
				</button>

				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="myBookingsScreen" onclick="navigateTo('myBookingsScreen')">
					<i class="fas fa-list"></i> My Bookings
				</button>

				

				<button class="sidebar-btn list-group-item list-group-item-action text-danger" onclick="logout()">
					<i class="fas fa-sign-out-alt"></i> Logout
				</button>

			</div>
		</div>
	</div>

	
	<div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="sidebar">
		<div class="offcanvas-header">
			<h5 class="offcanvas-title">Menu</h5>
			<button class="btn-close" data-bs-dismiss="offcanvas"></button>
		</div>

		<div class="offcanvas-body p-0">
			<div class="list-group list-group-flush">
				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="mapScreen" onclick="navigateTo('mapScreen')" data-bs-dismiss="offcanvas">
					<i class="fas fa-map"></i> Live Map
				</button>

				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="searchScreen" onclick="navigateTo('searchScreen')" data-bs-dismiss="offcanvas">
					<i class="fas fa-plane"></i> Airport Search
				</button>

				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="favoriteScreen" onclick="navigateTo('favoriteScreen')" data-bs-dismiss="offcanvas">
					<i class="fas fa-star"></i> Favorites
				</button>

				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="bookScreen" onclick="navigateTo('bookScreen')" data-bs-dismiss="offcanvas">
					<i class="fas fa-ticket-alt"></i> Book Flight
				</button>

				<button class=" list-group-item list-group-item-action sidebar-btn" data-screen="myBookingsScreen" onclick="navigateTo('myBookingsScreen')" data-bs-dismiss="offcanvas">
					<i class="fas fa-list"></i> My Bookings
				</button>

				

				<button class=" list-group-item list-group-item-action text-danger" onclick="logout()" data-bs-dismiss="offcanvas">
					<i class="fas fa-sign-out-alt"></i> Logout
				</button>
			</div>
		</div>
	</div>

	
	<div id="screensContainer" class="screens-container flex-grow-1 overflow-hidden">

		
		<div id="mapScreen" class="spaScreen">
			<div id="map" class="map-container"></div>
			<div id="planeInfoPanel" class="plane-info-panel">
			<div class="panel-header">
				<h5 id="panelFlightId">Flight</h5>
				<button class="btn btn-sm btn-danger" onclick="closePlanePanel()">Close</button>
			</div>

			<img id="panelPlaneImg" class="panel-plane-img" src="" alt="Plane">

			<div class="panel-data">
				<p><strong>Airline:</strong> <span id="panelAirline"></span></p>
				<p><strong>Registration:</strong> <span id="panelReg"></span></p>
				<p><strong>Type:</strong> <span id="panelType"></span></p>
				<p><strong>Altitude:</strong> <span id="panelAltitude"></span></p>
				<p><strong>Speed:</strong> <span id="panelSpeed"></span></p>
				<p><strong>Heading:</strong> <span id="panelHeading"></span></p>
			</div>
		</div>

		</div>

		
		<div id="bookScreen" class="spaScreen d-none p-4">
			<h3><i class="fas fa-ticket-alt"></i> Book a Flight</h3>

			
			<div id="bookStep1">
				<label class="form-label">Flight Number</label>
				<input type="text" id="bookFlightNumber" class="form-control" placeholder="e.g. DL47">
				<button class="btn btn-primary mt-3" onclick="searchFlightByNumber()">Search</button>
				<div id="bookingError" class="alert alert-danger d-none mt-3"></div>
			</div>

			
			<div id="bookStep2" class="d-none mt-4">
				<h5>Available Flights</h5>
				<div id="bookingFlightsResult"></div>
				<button class="btn btn-secondary mt-3" onclick="backToStep1()">Back</button>
			</div>

			
			<div id="bookStep3" class="d-none mt-4">
				<h5>Selected Flight</h5>
				<div id="selectedFlightInfo" class="mb-3"></div>

				<h5>Passenger Information</h5>
				<input type="text" id="passengerName" class="form-control mb-2" placeholder="Full Name">
				<input type="text" id="seatNumber" class="form-control mb-2" placeholder="Seat (e.g. 10A)">
				
				<button class="btn btn-success" onclick="confirmBooking()">Confirm</button>
				<button class="btn btn-secondary mt-2" onclick="backToStep2()">Back</button>

				<div id="bookingConfirmMsg" class="mt-3"></div>
			</div>
		</div>




		
		<div id="myBookingsScreen" class="spaScreen d-none p-4">
			<h3><i class="fas fa-list"></i> My Bookings</h3>
			<div id="myBookingsList"class="mt-3">
			</div>
		</div>

		
		<div id="searchScreen" class="spaScreen d-none p-4">

			<h3><i class="fas fa-plane"></i> Search for Airports</h3>


			<form id="airportSearchForm" class="row g-2 align-items-end mt-3">
				<div class="col-md-4">
					<label for="airportQuery" class="form-label">Airport code</label>
					<input type="text" id="airportQuery" class="form-control" placeholder="e.g. PRN, JFK, LHR">
				</div>
				<div class="col-md-2">
					<button type="submit" class="btn btn-primary w-100">
						<i class="fas fa-search"></i> Search
					</button>
				</div>
			</form>

			
			<div id="airportError" class="alert alert-danger mt-3 d-none"></div>

			
			<div id="airportInfo" class="card mt-3 d-none">
				<div class="card-body">
					<div class="row align-items-center text-center text-md-start">

						
						<div class="col-12 col-md-6 mb-3 mb-md-0">
							<h5 id="airportTitle" class="card-title mb-1"></h5>
							<p class="mb-0 text-muted" id="airportLocation"></p>
						</div>

						
						<div class="col-12 col-md-6 d-flex justify-content-center justify-content-md-end">
							<button class="btn btn-primary w-100 w-md-auto" id="add_to_favorite">
								Add to Favorites
							</button>
						</div>
					</div>
				</div>

			</div>

			
		<div id="airportFlights" class="mt-3 d-none">

			<h5><i class="fas fa-plane-departure"></i> Recent Departures</h5>
			<div class="table-responsive">
				<table class="table table-sm table-striped">
					<thead>
						<tr>
							<th>Flight</th>
							<th>Airline</th>
							<th>To</th>
							<th>Status</th>
							<th>Time</th>
							<th>Gate</th>
						</tr>
					</thead>
					<tbody id="departuresBody"></tbody>
				</table>
			</div>

			<h5 class="mt-4"><i class="fas fa-plane-arrival"></i> Recent Arrivals</h5>
			<div class="table-responsive">
				<table class="table table-sm table-striped">
					<thead>
						<tr>
							<th>Flight</th>
							<th>Airline</th>
							<th>From</th>
							<th>Status</th>
							<th>Time</th>
							<th>Gate</th>
						</tr>
					</thead>
					<tbody id="arrivalsBody"></tbody>
				</table>
			</div>

		</div>


		</div>


		
		<div id="favoriteScreen" class="spaScreen d-none p-4">
			<h3><i class="fas fa-star"></i> Favorite Airports</h3>
			<div id="favoritesList" class="mt-3">
			</div>
		</div>			


	</div>
</div>



	

	
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/startbootstrap-sb-admin-2/4.1.4/js/sb-admin-2.min.js"></script>
	
	<script src="js/auth.js"></script>
	<script src="js/dashboard.js"></script>

	<script src="js/screens/map.js"></script>
	<script src="js/screens/search.js"></script>
	<script src="js/screens/favorites.js"></script>
	<script src="js/screens/book.js"></script>
	<script src="js/screens/myBookings.js"></script>

	<script src="js/components/notifier.js"></script>
	<script src="js/components/timeFormat.js"></script>
	<script src="js/components/error.js"></script>

	<script src="js/api/bookApi.js"></script>
	<script src="js/api/favoritesApi.js"></script>
	<script src="js/api/mapPlaneApi.js"></script>
	<script src="js/api/myBookingsApi.js"></script>
	<script src="js/api/searchApi.js"></script>
	<script src="js/api/authApi.js"></script>



	
	<script type="module">
		import('./js/auth.js').then(module => {
			window.AuthGuard = module.default;
			window.logout = function() {
				 AuthApi.logout(() => {
					window.location.href = 'login.html';
				 });
			};
		}).catch(err => {
			console.error('Failed to load AuthGuard', err);
		});

		$(document).ready(function () {
			navigateTo("mapScreen"); 
		});
	</script>

</body>
</html>
